rad = Math.PI / 180;

function sector(paper, cx, cy, r, startAngle, endAngle, params) {
        var x1 = cx + r * Math.cos(-startAngle * rad),
        x2 = cx + r * Math.cos(-endAngle * rad),
        y1 = cy + r * Math.sin(-startAngle * rad),
        y2 = cy + r * Math.sin(-endAngle * rad);
    return paper.path(["M", cx, cy, "L", x1, y1, "A", r, r, 0, +(endAngle - startAngle > 180), 0, x2, y2, "z"]).attr(params);
}

function setInfo(element, name, info) {
	if(infoElement !== null) {
		infoElement.animate({"stroke-width": "2", "transform" : "s1"}, 200);
	}
	
	if(element !== null) {
		element.animate({"stroke-width": "5", "transform" : "s1.2"}, 200);
		$("#sideInfo").fadeIn("fast");
		$("#sideInfo h2").text(name);
		$("#sideInfo article").text(info);
	} else {
		$("#sideInfo").fadeOut("fast");
	}
	
	infoElement = element;
}

function openPanorama(url) {
	
	var lightbox = document.createElement('div');
	$(lightbox).attr("id","panoramaBox");
	
	$(lightbox).append("<a class='close'>Close</a><iframe src='"+url+"'></iframe>");
	
	$(lightbox).click(function(event) {
		$(lightbox).fadeOut("fast").remove();
	});
	
	$("body").append(lightbox);
	$(lightbox).fadeIn("fast");
}

function addSponsorSpot(paper, data) {
	
	var element = sector(paper, data.x, data.y, sponsor_types[data.type].radius, data.start, data.end, {fill: sponsor_types[data.type].color, "fill-opacity": "1", "stroke": sponsor_types[data.type].stroke, "stroke-width": "2", "stroke-linecap": 'round',"stroke-linejoin": 'round'});
	element.hover(function () {
		element.animate({"transform": "s1.2"}, 250);
		$("body").css("cursor", "pointer");
	},
	function () {
		if(element != infoElement)
			element.animate({"transform": "s1"}, 250);
			$("body").css("cursor", "auto");
		}
	);
	
	element.click(function(event) {
		setInfo(element, data.type + " level sponsor spot", data.info);
		event.stopPropagation();
	});
	
	return element;
}

function addCamera(paper, id, x, y, link) {
	
	var camera_source = "m 28.013191,5.7e-4 c -7.17576,-3.2e-4 -14.35087,2.73364 -19.8153398,8.19812 -9.57337,9.57337 -10.76267,24.3999 -3.56417,35.27649 -0.89992,0.63908 -1.94886,1.07781 -3.08757,1.25109 l 6.59734,3.0513 c 0.0181,0.0181 0.0363,0.0363 0.0544,0.0544 l 0.0207,-0.0207 4.6831598,2.16544 -5.2504198,-11.35562 c -0.11377,0.69233 -0.32164,1.35064 -0.60871,1.96341 -5.6513,-9.39559 -4.42217,-21.74444 3.6885098,-29.85513 9.56011,-9.5601 25.00407,-9.55751 34.56418,0.002 8.11193,8.11194 9.34024,20.45956 3.68591,29.85512 -0.28079,-0.60608 -0.47884,-1.25943 -0.58281,-1.94268 l -3.04871,6.59476 c -0.0186,0.0186 -0.0358,0.0383 -0.0544,0.057 l 0.0207,0.0207 -2.16544,4.68316 11.35303,-5.24784 c -1.14954,-0.18891 -2.20595,-0.6373 -3.11088,-1.27958 7.19849,-10.87608 6.0092,-25.70053 -3.56417,-35.2739 C 42.364021,2.73364 35.188921,3.3e-4 28.013151,0 z m 1.83389,12.90976 c -1.00936,0.008 -1.21101,0.0777 -1.6966,0.41963 -1.29248,0.85956 -1.71748,2.70255 -3.36991,3.12383 -4.48804,0.71847 -12.36417,0.96289 -12.80874,5.26337 -0.46854,4.60362 -0.22194,7.63263 -0.22794,11.44886 0,1.49374 -0.12742,4.60027 1.14229,4.60027 l 27.08356,0 c 1.31177,-0.10207 3.32227,0.43477 3.90609,-1.14748 0.59724,-4.62636 0.5793,-9.32615 0.17095,-13.96916 -0.002,-1.9982 -1.09036,-3.96717 -2.79745,-5.01471 -1.34352,-0.96702 -3.29994,-0.98604 -4.28945,-2.39598 -0.92252,-1.27352 -1.4848,-2.31827 -3.35177,-2.31827 -0.41261,0 -2.79584,-0.008 -3.27665,-0.0104 -0.18031,-10e-4 -0.34018,-10e-4 -0.48438,0 z m 1.81317,7.02733 c 4.42057,0 8.00385,3.58328 8.00385,8.00385 0,4.42056 -3.58328,8.00384 -8.00385,8.00384 -4.42057,0 -8.00384,-3.58328 -8.00384,-8.00384 0,-4.42057 3.58327,-8.00385 8.00384,-8.00385 z m 8.7084,21.11047 c -0.53835,10e-6 -0.99213,0.18656 -1.36247,0.55689 -0.36653,0.36654 -0.54913,0.81896 -0.54913,1.3573 0,0.53834 0.18124,0.99076 0.54395,1.35728 0.36652,0.36271 0.81894,0.54396 1.35728,0.54395 0.25962,1e-5 0.50669,-0.047 0.7434,-0.14246 0.23671,-0.0993 0.44616,-0.24154 0.62943,-0.4248 0.1718,-0.17181 0.30467,-0.37185 0.39631,-0.60094 0.0954,-0.23289 0.14245,-0.47722 0.14246,-0.73303 -10e-6,-0.25963 -0.047,-0.50396 -0.14246,-0.73304 -0.0916,-0.22908 -0.22723,-0.4358 -0.40667,-0.61908 -0.18327,-0.17943 -0.39136,-0.31638 -0.62425,-0.41184 -0.2329,-0.0993 -0.47587,-0.15022 -0.72785,-0.15023 z m -23.69294,0.0803 c -0.41235,10e-6 -0.83125,0.0322 -1.25886,0.0932 -0.42762,0.0611 -0.85987,0.15239 -1.29512,0.27456 l 0,1.61373 c 0.35889,-0.15653 0.72001,-0.27468 1.08272,-0.35487 0.36271,-0.0802 0.72246,-0.11914 1.07754,-0.11915 0.48106,1e-5 0.85295,0.0899 1.11639,0.26939 0.26344,0.17946 0.39372,0.4332 0.39372,0.76153 0,0.35508 -0.13559,0.61958 -0.40667,0.7952 -0.27108,0.17182 -0.68194,0.25903 -1.23554,0.25903 l -0.92731,0 0,1.41945 0.88068,0 c 0.62233,10e-6 1.0922,0.10071 1.40909,0.30306 0.32071,0.19853 0.48179,0.49384 0.48179,0.88327 0,0.37798 -0.15576,0.66797 -0.46883,0.87032 -0.30927,0.20236 -0.7576,0.30306 -1.34175,0.30306 -0.39325,0 -0.79335,-0.0523 -1.20187,-0.15541 -0.40471,-0.1069 -0.81284,-0.26267 -1.22518,-0.46884 l 0,1.70179 c 0.43143,0.14127 0.86641,0.24469 1.30548,0.31342 0.44288,0.0725 0.88454,0.10879 1.32361,0.10879 1.24466,0 2.18984,-0.21885 2.83891,-0.65792 0.64905,-0.44289 0.97392,-1.08731 0.97392,-1.93491 0,-0.56888 -0.15167,-1.03738 -0.45329,-1.40391 -0.29781,-0.37035 -0.73415,-0.63075 -1.31066,-0.77966 0.51542,-0.12981 0.90475,-0.35398 1.1682,-0.67088 0.26343,-0.3207 0.3963,-0.7302 0.39631,-1.23036 -10e-6,-0.73305 -0.27787,-1.2795 -0.83147,-1.64222 -0.5498,-0.36651 -1.38078,-0.5517 -2.49181,-0.55171 z m 16.68892,0 c -1.12631,10e-6 -1.99491,0.3866 -2.60578,1.15784 -0.61088,0.76742 -0.91695,1.86154 -0.91695,3.28182 0,1.41648 0.30607,2.51061 0.91695,3.28184 0.61087,0.76742 1.47947,1.15007 2.60578,1.15007 1.12248,0 1.98972,-0.38265 2.6006,-1.15007 0.61087,-0.77123 0.91694,-1.86536 0.91695,-3.28184 -1e-5,-1.42028 -0.30608,-2.5144 -0.91695,-3.28182 -0.61088,-0.77124 -1.47812,-1.15783 -2.6006,-1.15784 z m -7.51429,0.0129 c -1.24085,0 -2.21819,0.40282 -2.93215,1.21222 -0.71015,0.80561 -1.06459,1.91581 -1.06459,3.32846 0,1.3783 0.3047,2.44422 0.91176,3.19636 0.61088,0.74832 1.47144,1.12158 2.58248,1.12158 1.00794,0 1.81208,-0.27391 2.41151,-0.8237 0.59942,-0.55361 0.89881,-1.28798 0.89882,-2.20429 -10e-6,-0.8285 -0.26983,-1.50101 -0.80816,-2.01263 -0.53453,-0.5116 -1.23932,-0.7667 -2.11364,-0.76671 -0.34744,1e-5 -0.667,0.047 -0.96098,0.14247 -0.29399,0.0916 -0.56912,0.23253 -0.82111,0.41961 0.0611,-0.71777 0.27585,-1.25877 0.64239,-1.62148 0.36652,-0.36652 0.87931,-0.54913 1.53601,-0.54914 0.30543,1e-5 0.61695,0.043 0.93766,0.12692 0.32071,0.0802 0.66303,0.20379 1.02574,0.37559 l 0,-1.58005 c -0.36271,-0.12217 -0.72792,-0.21346 -1.09826,-0.27456 -0.37035,-0.0611 -0.75423,-0.0906 -1.14748,-0.0906 z m 14.51831,0.83664 c 0.27107,1e-5 0.50327,0.094 0.69418,0.28493 0.19471,0.1909 0.2901,0.42447 0.2901,0.69936 0,0.27109 -0.094,0.5007 -0.28492,0.69159 -0.19091,0.18709 -0.42447,0.28235 -0.69936,0.28234 -0.27872,10e-6 -0.51366,-0.0952 -0.70455,-0.28234 -0.18709,-0.18707 -0.27975,-0.41668 -0.27975,-0.69159 0,-0.27489 0.094,-0.50846 0.28493,-0.69936 0.1909,-0.19089 0.42446,-0.28492 0.69937,-0.28493 z m -7.00402,0.65792 c 0.47343,0 0.80907,0.21886 1.0076,0.65793 0.20235,0.43525 0.30306,1.18705 0.30306,2.25609 0,1.08049 -0.10071,1.84171 -0.30306,2.28459 -0.20235,0.44289 -0.53799,0.66569 -1.0076,0.66569 -0.47343,0 -0.81043,-0.2228 -1.01278,-0.66569 -0.20236,-0.44288 -0.30306,-1.2041 -0.30306,-2.28459 0,-1.06904 0.1007,-1.82084 0.30306,-2.25609 0.20235,-0.43907 0.53935,-0.65793 1.01278,-0.65793 z m -7.99348,2.97877 c 0.38943,10e-6 0.67941,0.12361 0.87032,0.37559 0.19471,0.24818 0.2901,0.62401 0.2901,1.12417 0,0.50015 -0.0954,0.87476 -0.2901,1.12675 -0.19091,0.24817 -0.48089,0.37299 -0.87032,0.37299 -0.38562,0 -0.67561,-0.12482 -0.87032,-0.37299 -0.19091,-0.25199 -0.28752,-0.6266 -0.28752,-1.12675 0,-0.50016 0.0966,-0.87599 0.28752,-1.12417 0.19471,-0.25198 0.4847,-0.37558 0.87032,-0.37559 z";
	
	var element = paper.path(camera_source);
	element.attr({"id": id , "fill": '#000000','stroke-width': '0','stroke-opacity': '1'});
	element.transform("t"+x+","+y+"s1.2");
	
	var hoverArea = paper.circle(x+25,y+25,50);
	hoverArea.attr({"fill":"#fff", "fill-opacity": "0", "stroke": "none"});
	
	hoverArea.hover(function () {
		element.animate({transform: "t"+x+","+y+"s1.5"}, 250);
		$("body").css("cursor", "pointer");
	},
	function () {
		element.animate({transform: "t"+x+","+y+"s1.2t"}, 250);
		$("body").css("cursor", "auto");
		}
	);
	
	hoverArea.click(function() {
		openPanorama(link);
	});
		
	return element;
	
}
$(document).ready(function() {

	sponsor_types = {};
	
	sponsor_types.Premium = {radius: "100", color: "#f55", stroke: "#c22"};
	sponsor_types.Gold = {radius: "50", color: "#f1f155", stroke: "#c1c122"};
	sponsor_types.Silver = {radius: "40", color: "#f1f1f1", stroke: "#c1c1c1"};
	sponsor_types.Basic = {radius: "10", color: "#5555f1", stroke: "#2222c1"};	

	infoElement = null;
	
	$("#sideInfo a.close").click(function(event) {
		setInfo(null);
	});
	$(".map_container").click(function(event) {
		setInfo(null);
	});
});	
